<div class="post-card">
  <div class="post-header">
    <img [src]="post.authorProfilePicture || 'assets/default-avatar.png'" 
         alt="{{ post.authorUsername }}" 
         class="post-avatar"
         (error)="onImageError($event)">
    
    <div class="post-author-info">
      <h6 class="post-author-name">{{ post.authorUsername }}</h6>
      <small class="post-timestamp">{{ formatDate(post.createdAt) }}</small>
    </div>

    <!-- 
      --- THIS IS THE MODIFIED SECTION ---
      I've added <span>Edit</span> and <span>Delete</span> to the buttons.
    -->
    <div *ngIf="post.authorId === currentUserId" class="ms-auto d-flex gap-2">
      <button 
              class="btn btn-sm btn-outline-primary"
              (click)="onEditPost()">
        <i class="bi bi-pencil"></i>
        <span>Edit</span>
      </button>
      <button 
              class="btn btn-sm btn-outline-danger"
              (click)="onDeletePost()">
        <i class="bi bi-trash"></i>
        <span>Delete</span>
      </button>
    </div>
    <!-- END OF MODIFIED SECTION -->

  </div>
  
  <div class="post-content">
    <p class="post-text">{{ post.content }}</p>
    
    <div *ngIf="post.mediaUrl" class="post-media">
      <img *ngIf="isImage(post.mediaType)" 
           [src]="getMediaUrl(post.mediaUrl)" 
           alt="Post media" 
           class="post-image"
           (error)="onImageError($event)"
           loading="lazy">
      
      <video *ngIf="isVideo(post.mediaType)" 
             controls 
             class="post-video"
             (error)="onVideoError($event)"
             preload="metadata">
        <source [src]="getMediaUrl(post.mediaUrl)" [type]="'video/' + getFileExtension(post.mediaUrl)">
        Your browser does not support the video tag.
      </video>
    </div>
  </div>
  
  <div class="post-actions">
    <button class="action-btn" 
            [class.liked]="post.likedByCurrentUser"
            (click)="onLike()"
            [disabled]="isLiking">
      <i class="bi" [class.bi-heart]="!post.likedByCurrentUser" 
                    [class.bi-heart-fill]="post.likedByCurrentUser"></i>
      <span *ngIf="!isLiking">{{ post.likeCount }} {{ post.likeCount === 1 ? 'Like' : 'Likes' }}</span>
      <div *ngIf="isLiking" class="spinner-border spinner-border-sm" role="status"></div>
    </button>
    
    <button class="action-btn comments" 
            (click)="toggleComments()">
      <i class="bi bi-chat"></i>
      <span>{{ post.commentCount }} {{ post.commentCount === 1 ? 'Comment' : 'Comments' }}</span>
    </button>

    <button class="action-btn ms-auto" 
            (click)="toggleReportModal()">
      <i class="bi bi-flag"></i>
      <span>Report</span>
    </button>
  </div>
  
  <div *ngIf="showComments" class="post-comments">
    <app-comments 
      [postId]="post.id"
      [isExpanded]="showComments">
    </app-comments>
  </div>

  <!-- REPORT MODAL OVERLAY -->
  <div *ngIf="showReportModal" class="report-modal-overlay" (click)="toggleReportModal()">
    <div class="report-modal-content" (click)="$event.stopPropagation()">
      <!-- SIMPLE REPORT FORM -->
      <div class="report-form">
        <div class="report-header">
          <h3>Report Post</h3>
          <button class="close-btn" (click)="toggleReportModal()">
            <i class="bi bi-x"></i>
          </button>
        </div>
        
        <div class="report-body">
          <p>Please provide a reason for reporting this post:</p>
          
          <textarea 
            #reportTextarea
            class="report-textarea" 
            placeholder="Describe the issue..."
            rows="5"
            maxlength="500"
            (input)="updateCharCount(reportTextarea.value)">
          </textarea>
          
          <div class="char-count">{{ currentCharCount }}/500</div>
        </div>
        
        <div class="report-footer">
          <button class="btn btn-secondary" (click)="toggleReportModal()">Cancel</button>
          <button 
            class="btn btn-danger" 
            (click)="submitReport(reportTextarea.value)"
            [disabled]="!reportTextarea.value.trim() || isSubmittingReport">
            <span *ngIf="!isSubmittingReport">Submit Report</span>
            <span *ngIf="isSubmittingReport" class="spinner-border spinner-border-sm"></span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

