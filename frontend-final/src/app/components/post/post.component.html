<div class="post-card">
  <div class="post-header">
    <img [src]="post.authorProfilePicture || 'assets/default-avatar.png'" 
         alt="{{ post.authorUsername }}" 
         class="post-avatar"
         (error)="onImageError($event)">
    
    <div class="post-author-info">
      <h6 class="post-author-name">{{ post.authorUsername }}</h6>
      <small class="post-timestamp">{{ formatDate(post.createdAt) }}</small>
    </div>

    <button *ngIf="post.authorId === currentUserId" 
            class="btn btn-sm btn-outline-danger ms-auto"
            (click)="onDeletePost()">
      <i class="bi bi-trash"></i>
    </button>
  </div>
  
  <div class="post-content">
    <p class="post-text">{{ post.content }}</p>
    
    <div *ngIf="post.mediaUrl" class="post-media">
      <img *ngIf="isImage(post.mediaType)" 
           [src]="getMediaUrl(post.mediaUrl)" 
           alt="Post media" 
           class="post-image"
           (error)="onImageError($event)"
           loading="lazy">
      
      <video *ngIf="isVideo(post.mediaType)" 
             controls 
             class="post-video"
             (error)="onVideoError($event)"
             preload="metadata">
        <source [src]="getMediaUrl(post.mediaUrl)" [type]="'video/' + getFileExtension(post.mediaUrl)">
        Your browser does not support the video tag.
      </video>
    </div>
  </div>
  
  <div class="post-actions">
    <button class="action-btn" 
            [class.liked]="post.likedByCurrentUser"
            (click)="onLike()"
            [disabled]="isLiking">
      <i class="bi" [class.bi-heart]="!post.likedByCurrentUser" 
                    [class.bi-heart-fill]="post.likedByCurrentUser"></i>
      <span *ngIf="!isLiking">{{ post.likeCount }} {{ post.likeCount === 1 ? 'Like' : 'Likes' }}</span>
      <div *ngIf="isLiking" class="spinner-border spinner-border-sm" role="status"></div>
    </button>
    
    <button class="action-btn comments" 
            (click)="toggleComments()">
      <i class="bi bi-chat"></i>
      <span>{{ post.commentCount }} {{ post.commentCount === 1 ? 'Comment' : 'Comments' }}</span>
    </button>

    <button class="action-btn ms-auto" data-bs-toggle="modal" [attr.data-bs-target]="'#reportModal-' + post.id">
      <i class="bi bi-flag"></i>
      <span>Report</span>
    </button>
  </div>
  
  <div *ngIf="showComments" class="post-comments">
    <app-comments 
      [postId]="post.id"
      [isExpanded]="showComments">
    </app-comments>
  </div>

  <app-report-modal 
    [reportTargetId]="post.id" 
    reportType="POST" 
    [modalId]="'reportModal-' + post.id">
  </app-report-modal>
</div>