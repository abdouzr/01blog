<!-- frontend/src/app/components/post/post.component.html -->
<div class="post-card">
  <!-- Post Header -->
  <div class="post-header">
    <img [src]="post.authorProfilePicture || 'assets/default-avatar.png'" alt="{{ post.authorUsername }}'s avatar"
      class="post-avatar" (error)="$any($event.target).src='assets/default-avatar.png'">

    <div class="post-author-info">
      <h3 class="post-author-name">{{ post.authorUsername || 'Anonymous' }}</h3>
      <span class="post-timestamp">{{ formatDate(post.createdAt) }}</span>
    </div>

    <!-- Edit and Delete buttons (only for post owner) -->
    <div class="ms-auto d-flex gap-2" *ngIf="currentUserId === post.authorId">
      <button class="btn btn-sm btn-outline-primary" (click)="onEditPost()" title="Edit post">
        <i class="bi bi-pencil-fill"></i> Edit
      </button>
      <button 
        *ngIf="showDeleteButton"
        class="btn btn-sm btn-outline-danger" 
        (click)="onDeletePost()" 
        title="Delete post">
        <i class="bi bi-trash-fill"></i> Delete
      </button>
    </div>
  </div>

  <!-- Post Content -->
  <div class="post-content" (click)="viewFullPost()" style="cursor: pointer;">
    <!-- Truncated Text with Read More -->
    <p class="post-text" *ngIf="post.content">
      {{ getTruncatedContent() }}
      <span *ngIf="isTruncated()" class="read-more-link">Read more</span>
    </p>

    <!-- Post Media - LIMITED TO 3 -->
    <div *ngIf="post.mediaUrls && post.mediaUrls.length > 0" class="post-media">
      <!-- Single media -->
      <div *ngIf="getVisibleMediaUrls().length === 1" class="single-media">
        <img *ngIf="isImage(post.mediaTypes[0])" [src]="getMediaUrl(post.mediaUrls[0])" alt="Post media"
          class="post-media-single" (error)="onImageError($event)" loading="lazy">

        <video *ngIf="isVideo(post.mediaTypes[0])" controls class="post-media-single" (error)="onVideoError($event)"
          preload="metadata" (click)="$event.stopPropagation()">
          <source [src]="getMediaUrl(post.mediaUrls[0])" [type]="'video/' + getFileExtension(post.mediaUrls[0])">
          Your browser does not support the video tag.
        </video>
      </div>

      <!-- Multiple media - LIMITED grid layout -->
      <div *ngIf="getVisibleMediaUrls().length > 1" class="multiple-media">
        <div class="row g-1">
          <div *ngFor="let mediaUrl of getVisibleMediaUrls(); let i = index"
            [class]="getMediaGridClass(getVisibleMediaUrls().length, i)" class="position-relative">
            <div class="media-container position-relative">
              <img *ngIf="isImage(post.mediaTypes[i])" [src]="getMediaUrl(mediaUrl)" alt="Post media"
                class="post-media-grid" (error)="onImageError($event)" loading="lazy">

              <video *ngIf="isVideo(post.mediaTypes[i])" class="post-media-grid" (error)="onVideoError($event)"
                preload="metadata" (click)="$event.stopPropagation()">
                <source [src]="getMediaUrl(mediaUrl)" [type]="'video/' + getFileExtension(mediaUrl)">
              </video>

              <!-- Video play icon overlay -->
              <div *ngIf="isVideo(post.mediaTypes[i])" class="video-overlay">
                <i class="bi bi-play-circle-fill"></i>
              </div>

              <!-- Show "+X more" overlay on last image if there are more -->
              <div *ngIf="i === getVisibleMediaUrls().length - 1 && hasMoreMedia()" class="more-media-overlay">
                <span>+{{ getRemainingMediaCount() }} more</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Confirmation modal -->
<div class="confirm-overlay" *ngIf="confirmVisible">
  <div class="confirm-modal" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
    <h5 id="confirmTitle">Confirm Deletion</h5>
    <p>Are you sure you want to delete this post? This action is irreversible.</p>
    <div class="confirm-preview" *ngIf="post.content">{{ post.content | slice:0:120 }}</div>
    <div class="confirm-actions">
      <button type="button" class="confirm-btn cancel" (click)="cancelDelete()">Cancel</button>
      <button type="button" class="confirm-btn delete" (click)="confirmDelete()">Delete</button>
    </div>
  </div>
</div>