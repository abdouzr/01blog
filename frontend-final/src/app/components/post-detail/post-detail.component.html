<!-- frontend/src/app/components/post-detail/post-detail.component.html -->
<div class="post-detail-container">
  <!-- Back Button -->
  <div class="mb-4">
    <button class="btn btn-outline-secondary" (click)="goBack()">
      <i class="bi bi-arrow-left"></i> Back to Feed
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2">Loading post...</p>
  </div>

  <!-- Post Content -->
  <div *ngIf="!isLoading && post" class="post-card detailed-view">
    <!-- Post Header -->
    <div class="post-header">
      <img 
        [src]="post.authorProfilePicture || 'assets/default-avatar.png'" 
        alt="{{ post.authorUsername }}'s avatar"
        class="post-avatar"
        (error)="$any($event.target).src='assets/default-avatar.png'">
      
      <div class="post-author-info">
        <h3 class="post-author-name">{{ post.authorUsername || 'Anonymous' }}</h3>
        <span class="post-timestamp">{{ formatDate(post.createdAt) }}</span>
      </div>

      <!-- Edit and Delete buttons (only for post owner) -->
      <div class="ms-auto d-flex gap-2" *ngIf="currentUserId === post.authorId">
        <button 
          class="btn btn-sm btn-outline-primary" 
          (click)="onEditPost()"
          title="Edit post">
          <i class="bi bi-pencil-fill"></i> Edit
        </button>
        <button 
          class="btn btn-sm btn-outline-danger" 
          (click)="onDeletePost()"
          title="Delete post">
          <i class="bi bi-trash-fill"></i> Delete
        </button>
      </div>
    </div>

    <!-- Post Content - Full version -->
    <div class="post-content-full">
      <p class="post-text-full">{{ post.content }}</p>

      <!-- Post Media - Show all in detail view -->
      <div *ngIf="post.mediaUrls && post.mediaUrls.length > 0" class="post-media-full">
        <!-- Single media -->
        <div *ngIf="post.mediaUrls.length === 1" class="single-media-full">
          <img *ngIf="isImage(post.mediaTypes[0])" 
               [src]="getMediaUrl(post.mediaUrls[0])" 
               alt="Post media" 
               class="post-media-single-full"
               (error)="onImageError($event)"
               loading="lazy">
          
          <video *ngIf="isVideo(post.mediaTypes[0])" 
                 controls 
                 class="post-media-single-full"
                 (error)="onVideoError($event)"
                 preload="metadata">
            <source [src]="getMediaUrl(post.mediaUrls[0])" [type]="'video/' + getFileExtension(post.mediaUrls[0])">
            Your browser does not support the video tag.
          </video>
        </div>

        <!-- Multiple media - Grid layout -->
        <div *ngIf="post.mediaUrls.length > 1" class="multiple-media-full">
          <div class="row g-2">
            <div *ngFor="let mediaUrl of post.mediaUrls; let i = index" 
                 [class]="getMediaGridClass(post.mediaUrls.length, i)"
                 class="position-relative">
              <div class="media-container-full position-relative">
                <img *ngIf="isImage(post.mediaTypes[i])" 
                     [src]="getMediaUrl(mediaUrl)" 
                     alt="Post media" 
                     class="post-media-grid-full"
                     (error)="onImageError($event)"
                     loading="lazy">
                
                <video *ngIf="isVideo(post.mediaTypes[i])" 
                       class="post-media-grid-full"
                       controls
                       (error)="onVideoError($event)"
                       preload="metadata">
                  <source [src]="getMediaUrl(mediaUrl)" [type]="'video/' + getFileExtension(mediaUrl)">
                </video>
                
                <!-- Video play icon overlay -->
                <div *ngIf="isVideo(post.mediaTypes[i])" class="video-overlay-full">
                  <i class="bi bi-play-circle-fill"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Post Actions -->
    <div class="post-actions">
      <button
        class="action-btn"
        [class.liked]="post.likedByCurrentUser"
        (click)="onLike()"
        [disabled]="isLiking">
        <i [class]="post.likedByCurrentUser ? 'bi bi-heart-fill' : 'bi bi-heart'"></i>
        <span class="action-text">{{ post.likedByCurrentUser ? 'Liked' : 'Like' }}</span>
        <span class="action-count">({{ post.likeCount || 0 }})</span>
      </button>

      <button class="action-btn comments">
        <i class="bi bi-chat"></i>
        <span class="action-text">Comments</span>
        <span class="action-count">({{ post.commentCount || 0 }})</span>
      </button>

      <button
        class="action-btn ms-auto"
        (click)="toggleReportModal()"
        title="Report this post">
        <i class="bi bi-flag"></i>
        <span class="action-text">Report</span>
      </button>
    </div>

    <!-- Comments Section - Always visible in detail view -->
    <div class="post-comments-full">
      <app-comments [postId]="post.id" [isExpanded]="true"></app-comments>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="!isLoading && !post" class="alert alert-danger text-center">
    <h4>Post Not Found</h4>
    <p>The post you're looking for doesn't exist or has been deleted.</p>
    <button class="btn btn-primary" (click)="goBack()">Return to Feed</button>
  </div>

  <!-- Report Modal -->
  <div *ngIf="showReportModal" class="report-modal-overlay" (click)="toggleReportModal()">
    <div class="report-modal-content" (click)="$event.stopPropagation()">
      <div class="report-header p-4 border-bottom">
        <h3>Report Post</h3>
      </div>
      <div class="report-body p-4">
        <p>Please provide a reason for reporting this post. Our moderation team will review it.</p>
        <textarea 
          #reportReason
          class="report-textarea"
          placeholder="Describe why you're reporting this post..."
          maxlength="500"
          (input)="updateCharCount(reportReason.value)"
          [disabled]="isSubmittingReport"></textarea>
        <div class="char-count">{{ currentCharCount }}/500</div>
      </div>
      <div class="report-footer p-4 border-top d-flex justify-content-end gap-2">
        <button 
          class="btn btn-secondary" 
          (click)="toggleReportModal()"
          [disabled]="isSubmittingReport">
          Cancel
        </button>
        <button 
          class="btn btn-danger" 
          (click)="submitReport(reportReason.value)"
          [disabled]="isSubmittingReport || !reportReason.value.trim()">
          <span *ngIf="isSubmittingReport" class="spinner-border spinner-border-sm me-2"></span>
          {{ isSubmittingReport ? 'Submitting...' : 'Submit Report' }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Delete confirmation modal -->
<div *ngIf="confirmDeleteVisible" class="confirm-overlay">
  <div class="confirm-modal" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
    <h5 id="confirmTitle">Confirm Deletion</h5>
    <p>Are you sure you want to delete this post? This action is irreversible.</p>
    <div class="confirm-preview" *ngIf="post?.content">{{ post?.content | slice:0:140 }}</div>
    <div class="confirm-actions">
      <button class="confirm-btn cancel" (click)="cancelDelete()">Cancel</button>
      <button class="confirm-btn delete" (click)="confirmDelete()">Delete</button>
    </div>
  </div>
</div>
